require "cassandra"
#test
d = "00:00;7.2;2.4;5.3
00:05;6.8;2.4;3.3
00:12;7.2;2.3;1.7
00:18;6.7;2.3;3.5
00:23;6.8;2.3;1.4
00:29;8.1;2.4;1.9
00:34;9.6;6.2;1.4
00:39;8.3;11.7;2.7
00:47;9.5;9.0;1.5
00:57;7.3;2.4;2.2
01:02;6.7;2.3;2.7
01:08;6.8;2.3;2.7
01:13;7.2;2.3;1.6
01:22;6.8;2.3;2.1
01:29;7.7;2.4;1.5
01:36;9.3;8.0;1.6
01:43;8.1;11.9;1.8
01:49;7.0;4.2;1.5
01:55;7.3;2.4;2.2
02:00;6.6;2.3;5.6
02:06;6.8;2.3;3.7
02:13;7.2;2.3;2.1
02:20;6.8;2.3;2.4
02:27;7.2;2.3;1.8
02:32;9.8;3.7;0.6
02:38;7.8;11.7;2.9
02:43;8.1;12.3;1.2
02:49;9.8;4.6;1.5
02:54;6.8;2.3;1.4
03:06;7.0;2.3;3.2
03:13;7.2;2.3;1.2
03:19;6.7;2.3;3.0
03:25;7.2;2.3;1.5
03:30;7.6;2.3;1.2
03:36;9.8;8.9;2.3
03:41;8.2;11.8;1.8
03:46;9.4;9.3;1.6
03:52;7.6;2.5;0.7
03:57;7.3;2.4;5.0
04:03;7.4;2.5;3.6
04:08;7.5;2.4;4.5
04:15;7.0;2.3;2.0
04:20;6.8;2.4;2.5
04:25;7.4;2.4;1.6
04:31;9.0;2.4;0.9
04:36;8.3;10.5;2.5
04:44;8.0;12.1;1.7
04:51;8.8;3.8;1.1
04:57;7.3;2.4;3.7
05:03;6.7;2.3;2.6
05:08;6.8;2.3;2.9
05:14;7.1;2.3;1.4
05:19;6.8;2.3;2.9
05:25;7.3;2.3;1.4
05:30;7.5;2.3;1.4
05:35;9.7;8.3;1.5
05:43;8.0;11.9;1.6
05:48;10.0;5.6;1.7
05:54;6.8;2.3;1.2
06:02;7.0;2.3;4.8
06:07;6.8;2.4;4.7
06:13;7.1;2.3;1.8
06:22;6.8;2.3;2.2
06:29;7.7;2.4;1.5
06:34;9.8;7.3;1.8
06:40;8.3;11.7;2.5
06:45;9.1;10.6;1.3
06:50;8.1;4.2;1.2
06:55;7.3;2.4;2.1
07:00;6.7;2.3;3.2
07:08;6.8;2.3;2.5
07:14;7.2;2.3;1.6
07:21;6.8;2.3;2.1
07:26;7.3;2.3;2.1
07:32;9.7;2.4;0.7
07:37;7.9;11.5;2.7
07:43;8.1;12.2;1.3
07:49;9.5;5.1;1.5
07:55;7.2;2.4;3.1
08:01;6.7;2.3;6.1
08:09;6.9;2.3;4.5
08:15;7.1;2.3;2.7
08:24;6.8;2.3;2.1
08:32;9.3;2.5;1.3
08:39;8.6;9.5;2.7
08:45;8.8;12.3;1.2
08:50;10.6;6.2;1.4
08:57;8.0;2.5;4.6
09:04;7.5;2.5;2.6
09:12;8.0;2.5;2.4
09:18;9.6;2.5;3.2
09:24;9.0;2.6;1.8
09:30;10.9;2.6;1.4
09:39;13.8;8.8;2.6
09:47;11.4;11.0;1.7
09:54;9.4;3.6;2.2
10:00;8.2;2.5;5.3
10:05;8.3;2.6;3.8
10:12;9.1;2.5;2.7
10:17;8.4;2.5;4.4
10:25;8.7;2.6;2.0
10:33;10.7;2.7;1.5
10:38;9.4;10.9;3.5
10:44;10.2;12.3;1.5
10:50;11.9;7.6;1.4
10:57;9.5;2.6;3.3
11:02;8.5;2.5;2.9
11:07;8.8;2.6;3.8
11:12;9.1;2.5;1.1
11:17;8.0;2.5;3.6
11:22;8.3;2.5;1.6
11:28;9.4;2.6;2.1
11:34;10.8;3.2;1.4
11:40;9.6;12.1;2.3
11:46;9.8;11.4;2.0
11:51;10.9;4.8;0.7
11:56;10.0;2.7;5.1
12:02;8.3;2.5;4.3
12:07;8.1;2.6;5.0
12:12;8.9;2.7;1.4
12:17;7.7;2.5;4.6
12:22;8.0;2.5;1.8
12:27;8.9;2.7;2.4
12:32;11.2;2.6;0.7
12:37;9.2;11.1;2.9
12:42;9.7;12.1;2.0
12:47;10.6;9.2;2.5
12:52;9.0;3.0;0.8
12:57;8.9;2.6;4.7
13:02;7.8;2.5;2.9
13:07;7.9;2.5;3.4
13:13;8.4;2.5;1.2
13:18;7.7;2.5;2.9
13:23;8.0;2.5;1.6
13:28;9.3;2.6;1.9
13:33;10.6;2.6;1.1
13:38;8.7;10.8;2.6
13:43;9.8;12.4;1.4
13:48;10.7;9.6;2.6
13:53;9.0;3.3;1.2
13:58;8.5;2.5;6.2
14:03;7.9;2.7;3.6
14:08;8.5;2.6;5.5
14:13;8.5;2.5;2.3
14:19;8.2;2.5;3.0
14:25;8.8;2.6;2.0
14:30;9.0;2.6;1.5
14:36;11.4;9.0;2.2
14:41;9.8;12.0;2.2
14:46;11.0;10.2;2.0
14:51;9.4;4.5;1.2
14:56;9.0;2.6;3.8
15:01;7.8;2.5;3.0
15:06;8.0;2.6;3.9
15:12;8.6;2.5;1.6
15:17;7.7;2.5;3.7
15:22;7.8;2.5;2.0
15:27;8.5;2.5;2.8
15:32;11.3;2.6;0.8
15:37;9.0;11.2;2.5
15:42;9.7;12.5;1.9
15:47;10.6;9.1;3.1
15:52;8.8;2.8;1.0
15:57;8.8;2.6;5.0
16:02;7.7;2.5;3.9
16:07;8.2;2.6;6.2
16:13;9.2;2.6;1.7
16:18;8.0;2.5;3.7
16:23;8.1;2.5;1.5
16:28;9.0;2.6;2.5
16:33;11.2;2.6;1.4
16:38;9.4;10.8;2.7
16:43;9.7;12.3;1.5
16:48;10.6;9.6;2.2
16:53;9.1;3.2;1.3
16:58;8.6;2.6;4.5
17:03;7.7;2.5;2.7
17:08;7.8;2.5;3.4
17:14;8.4;2.5;2.5
17:19;7.7;2.5;3.0
17:24;7.8;2.5;1.8
17:29;9.4;2.6;1.9
17:34;10.9;6.1;1.7
17:39;8.8;11.9;2.3
17:44;9.3;12.4;1.7
17:49;7.9;3.0;2.2
17:54;8.1;2.5;2.7
17:59;8.0;2.5;5.9
18:04;7.8;2.6;3.6
18:09;8.4;2.5;4.5
18:14;7.7;2.5;3.5
18:19;7.7;2.5;2.8
18:25;8.5;2.5;1.7
18:30;8.1;2.5;1.8
18:35;10.9;7.6;2.4
18:40;9.6;11.9;2.4
18:45;9.4;11.4;1.6
18:50;10.0;4.8;1.9
18:55;5.5;1.9;0.9
19:00;7.8;2.7;0.6
19:05;8.7;2.8;0.6
19:10;9.8;3.0;0.7
19:15;8.5;2.8;0.6
19:26;9.1;2.9;8.7
19:31;10.7;2.8;0.2
19:36;9.2;9.2;0.3
19:42;9.9;11.8;5.9
19:47;10.4;10.3;1.0
19:52;8.7;4.4;1.0
19:57;9.0;2.8;0.6
20:02;7.6;2.6;16.4
20:07;7.8;2.6;1.0
20:13;8.8;2.7;0.2
20:18;7.6;2.5;0.9
20:23;7.9;2.7;6.9
20:28;9.4;2.7;0.2
20:33;10.5;4.6;0.2
20:38;8.9;12.0;1.5
20:43;9.7;11.8;6.1
20:48;10.9;7.0;0.2
20:54;7.9;2.6;0.3
20:59;9.1;2.8;0.0
21:04;8.3;2.8;0.0
21:09;8.0;2.6;0.3
21:14;8.5;2.6;0.3
21:19;7.6;2.6;3.5
21:25;8.8;2.7;3.7
21:30;8.7;2.6;0.2
21:35;10.6;8.9;0.2
21:40;9.9;11.8;4.4
21:46;10.3;10.3;2.0
21:51;8.6;3.9;0.3
21:56;9.1;2.7;0.3
22:02;7.6;2.6;13.1
22:07;7.5;2.5;2.6
22:12;8.9;2.7;0.3
22:17;7.4;2.5;0.5
22:22;7.8;2.6;6.4
22:27;9.0;2.7;0.5
22:32;11.1;3.2;0.3
22:37;8.6;12.1;0.6
22:43;9.8;11.5;5.8
22:48;11.0;8.6;0.3
22:53;7.9;2.6;0.6
22:58;8.9;2.7;0.0
23:03;8.4;2.9;0.0
23:08;7.8;2.6;0.3
23:13;8.7;2.7;0.4
23:18;7.6;2.5;2.4
23:24;7.8;2.7;4.8
23:29;9.6;2.7;0.6
23:34;10.3;3.5;0.7
23:39;8.8;11.9;2.4
23:44;9.6;11.8;4.8
23:49;10.9;7.0;0.6
23:54;8.6;2.7;0.8
23:59;8.4;2.8;0.0"

monit = Cassandra.new("Monit")
service = Service.find(35)
d = d.split(/\n\s*/)
d.each do |da|
  da = da.split(";")
  ti = da[0]
  ti = Time.parse(da[0].gsub(/\-/,"/")).to_i.to_s
  monit.insert(:Metrics, service.uuid, { ti => { "load1" => da[1], "load5" => da[2], "load15" => da[3] }})
end
#data
#data = { UUID.new(Time.parse("2010-02-24 18:05:40"))

services = Service.all(:conditions =>{:type_id => 3})
monit.insert(:TopN2, "root.disk", {services[0].uuid => {"avail" => 5, "total"=> 20, "used" => 15, "usage" => 75}, services[1].uuid => {"avail" => 10, "total"=> 20, "used" => 20, "usage" => 50}})
d = monit.get(:TopN2, "root.disk")
